

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C18LW - Contents of the manual</title>
    <link rel="icon" type="image/png" href="facion.png">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
  /* Bouton flottant */
    .menu-wrapper {
      position: fixed;
      top: 1rem;
      left: 1rem;
      z-index: 50;
    }

    .menu-button {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: rgba(255, 255, 255, 0.9);
      color: black; /* texte noir */
      border-radius: 0.5rem;
      padding: 0.5rem;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: background 0.3s;
      width: 60px;
    }

    .menu-button:hover {
      background: rgba(255, 255, 255, 1);
    }

    .menu-button img {
      margin-bottom: 0.25rem;
      width: 2.5rem;
      height: 2.5rem;
    }

    .menu-button span {
      font-size: 0.875rem;
      font-weight: 600;
      color: black; /* bien noir */
    }

    /* Menu déroulant */
    .menu-panel {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease;
      margin-top: 0.5rem;
    }

    .menu-panel.open {
      max-height: 500px;
    }

    .menu-section {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 0.5rem;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      padding: 0.5rem;
      margin-bottom: 0.5rem;
      display: flex;
      flex-direction: column;
    }

    .menu-section a {
      display: block;
      padding: 0.5rem 0.75rem;
      border-radius: 0.25rem;
      color: black; /* texte noir */
      text-decoration: none;
      transition: background 0.2s;
    }

    .menu-section a:hover {
      background: #e5e7eb; /* gris clair */
      color: black; /* reste noir */
    }





        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }

        h1 {
            text-align: center;
            color: #444;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .content-box {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            line-height: 1.6;
        }

        .page-header {
            font-weight: bold;
            color: #0056b3;
            margin-bottom: 10px;
        }

        .error-message {
            text-align: center;
            color: #d9534f;
            font-size: 1.1em;
        }
    </style>
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <!-- Bouton flottant -->
  <div class="menu-wrapper">
    <div id="menuToggle" class="menu-button">
      <img src="c18lw.png" alt="Logo">
      <span>Menu</span>
    </div>

    <!-- Contenu du menu -->
    <div id="menuContent" class="menu-panel">
      <!-- Bloc 1 -->
      <div class="menu-section">
        <a href="index.htm">Home</a>
        <a href="database.htm">Data Base</a>
        <a href="resultatrecherche.htm">Advanced Search</a>
      </div>
      <!-- Bloc 2 -->
      <div class="menu-section">
        <a id="viewpdf" href="#">View PDF</a>
        <a id="viewtxt" href="#">View Text</a>
        <a id="viewocr" href="#">View OCR</a>
      </div>
    </div>
  </div>
    <div class="container">
        <h1 id="manualTitle">Loading...</h1>
        <div id="metadataBox" class="content-box" style="background:#f9f9f9;">
            <div class="page-header">Informations</div>
            <p id="metadataContent">Loading metadata...</p>
        </div>
        <div id="contentContainer">
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const filename = params.get('pdf');

            const titleElement = document.getElementById('manualTitle');
            const viewpdfElement = document.getElementById('viewpdf');
            const viewtxtElement = document.getElementById('viewtxt');
            const viewocrElement = document.getElementById('viewocr');
            const contentContainer = document.getElementById('contentContainer');

            if (!filename) {
                titleElement.textContent = "Error: No file specified.";
                return;
            }

            titleElement.textContent = `Contents of the manual  : ${filename}`;
            viewpdfElement.href = `${filename}`;
            viewtxtElement.href = `txt.htm?pdf=${filename}`;
            viewocrElement.href = `ocr.htm?pdf=${filename}`;
            // --- DEBUT : SIMULATION DU FICHIER CSV ---
            // Remplacez ce bloc par une requête `fetch` vers votre fichier data.csv
            //const mockCsvData = [
            //    '1.pdf;"Première page du manuel 1.pdf. Ce texte est un exemple de contenu de page.";"Deuxième page du manuel 1.pdf. Il s\'agit d\'une autre section du livre.";"Troisième page de ce livre. La fin."',
            //    '2.pdf;"Contenu de la page 1 du manuel 2.pdf.";"Page 2 du manuel 2.pdf.";"Page 3 du manuel 2.pdf."',
            //    'autre_manuel.pdf;"Contenu du premier manuel...";"Suite du contenu..."'
            //].join('\n');
            // --- FIN : SIMULATION DU FICHIER CSV ---

            // Pour utiliser un vrai fichier, remplacez le bloc ci-dessus par :
              fetch('data.csv')
                  .then(response => {
                      if (!response.ok) {
                          throw new Error('The data.csv file could not be loaded.');
                      }
                      return response.text();
                  })
                  .then(csvData => {
                      processData(csvData);
                  })
                  .catch(error => {
                      titleElement.textContent = `Loading error : ${error.message}`;
                      console.error(error);
                  });
                // Charger le fichier sec.txt (format JSON)

// fetch sec.txt qui utilise des ' pour délimiter les chaînes
fetch('sec.txt')
  .then(response => {
    if (!response.ok) throw new Error('sec.txt introuvable');
    return response.text();
  })
  .then(text => {
    // Entourer d'un tableau si besoin
    let pythonLike = text.trim();
    if (!pythonLike.startsWith('[')) {
      pythonLike = '[' + pythonLike + ']';
    }

    // Convertir en vrai objet JS avec eval (car c'est du format Python dict)
    let metadataList;
    try {
      metadataList = eval(pythonLike); // ⚠️ seulement si tu contrôles le fichier
    } catch (e) {
      console.error("Erreur d'interprétation Python-like :", e);
      throw e;
    }

    // Trouver les infos du PDF courant
    const meta = metadataList.find(item => item.filename === filename);
    const metaBox = document.getElementById('metadataContent');
    if (meta) {
      metaBox.innerHTML = `
        <strong>Title:</strong> ${meta.title}<br>
        <strong>Author:</strong> ${meta.author}<br>
        <strong>Date:</strong> ${meta.date}<br>
        <strong>Edition:</strong> ${meta.edition}<br>
        <strong>Country:</strong> ${meta.pays}
      `;
    } else {
      metaBox.textContent = "No metadata found for this file.";
    }
  })
  .catch(err => {
    console.error(err);
    const metaBox = document.getElementById("metadataContent");
    if (metaBox) metaBox.textContent = "Error loading metadata.";
  });



            function processData(csvString) {
                const rows = csvString.trim().split('\n');
                let found = false;

                for (const row of rows) {
                    // MODIFICATION ICI :
                    // Ancienne ligne (pour les virgules) : const columns = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    // Nouvelle ligne (pour les points-virgules) :
                    const columns = row.split('/newpage/');


                    const rowFilename = columns[0].replace(/"/g, ''); // Nettoyer les guillemets si présents

                    if (rowFilename === filename) {
                        found = true;
                        // Afficher chaque page (chaque colonne du CSV)

                        for (let i = 2; i < columns.length; i++) {
                            const pageContent = columns[i].replace(/"/g, '').trim(); // Nettoyer et enlever les espaces

                            const box = document.createElement('div');
                            box.className = 'content-box';
                            box.innerHTML = `<div class="page-header">Page ${i-1}</div><p>${pageContent}</p>`;
                            contentContainer.appendChild(box);
                        }
                        break;
                    }
                }

                if (!found) {
                    contentContainer.innerHTML = '<div class="error-message">No content found for this file.</div>';
                }
            }

            // Exécute la fonction de traitement avec les données simulées
            processData(mockCsvData);
        });
    </script>
  <script>
    const toggleBtn = document.getElementById('menuToggle');
    const menu = document.getElementById('menuContent');

    toggleBtn.addEventListener('click', () => {
      menu.classList.toggle('open');
    });
  </script>
 <script>
  // Utilisation de variables locales pour éviter les conflits globaux
  (function() {
    const SB_URL = "https://vxcgquyvndvnnzpvbabw.supabase.co";
    const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ4Y2dxdXl2bmR2bm56cHZiYWJ3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgwNjUyNDYsImV4cCI6MjA4MzY0MTI0Nn0.yUi9FBmQHR85doK7CyIS2VFyzZXavmD_dbNcKPEp0A4";

    // ✅ On change le nom de la constante pour éviter l'erreur "already declared"
    // On accède à l'objet de la bibliothèque via "supabase.createClient" 
    // car le CDN expose l'objet 'supabase'
    const myAppClient = supabase.createClient(SB_URL, SB_KEY);

    async function protectPage() {
      // 1. Vérifier si l'utilisateur est connecté
      const { data: { session }, error } = await myAppClient.auth.getSession();

      if (error || !session) {
        window.location.href = "login.htm";
        return;
      }

      // 2. Vérifier si le profil est approuvé
      const user = session.user;
      const { data, error: profileError } = await myAppClient
        .from("profiles")
        .select("approved")
        .eq("id", user.id)
        .single();

      if (profileError || !data || data.approved !== true) {
        alert("Your account is not yet approved by the administrator.");
        await myAppClient.auth.signOut();
        window.location.href = "login.htm";
      }
    }

    // Lancer la protection au chargement
    protectPage();
  })();
</script>   
</body>

</html>







